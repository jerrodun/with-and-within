(function(h,n){typeof define=="function"&&define.amd?define(["flickity/js/index","fizzy-ui-utils/utils"],n):typeof module=="object"&&module.exports?module.exports=n(require("flickity"),require("fizzy-ui-utils")):n(h.Flickity,h.fizzyUIUtils)})(this,function(n,p){var f=n.Slide,c=f.prototype.updateTarget;f.prototype.updateTarget=function(){if(c.apply(this,arguments),!!this.parent.options.fade){var e=this.target-this.x,s=this.cells[0].x;this.cells.forEach(function(i){var a=i.x-s-e;i.renderPosition(a)})}},f.prototype.setOpacity=function(e){this.cells.forEach(function(s){s.element.style.opacity=e})};var t=n.prototype;n.createMethods.push("_createFade"),t._createFade=function(){this.fadeIndex=this.selectedIndex,this.prevSelectedIndex=this.selectedIndex,this.on("select",this.onSelectFade),this.on("dragEnd",this.onDragEndFade),this.on("settle",this.onSettleFade),this.on("activate",this.onActivateFade),this.on("deactivate",this.onDeactivateFade)};var u=t.updateSlides;t.updateSlides=function(){u.apply(this,arguments),this.options.fade&&this.slides.forEach(function(e,s){var i=s==this.selectedIndex?1:0;e.setOpacity(i)},this)},t.onSelectFade=function(){this.fadeIndex=Math.min(this.prevSelectedIndex,this.slides.length-1),this.prevSelectedIndex=this.selectedIndex},t.onSettleFade=function(){if(delete this.didDragEnd,!!this.options.fade){this.selectedSlide.setOpacity(1);var e=this.slides[this.fadeIndex];e&&this.fadeIndex!=this.selectedIndex&&this.slides[this.fadeIndex].setOpacity(0)}},t.onDragEndFade=function(){this.didDragEnd=!0},t.onActivateFade=function(){this.options.fade&&this.element.classList.add("is-fade")},t.onDeactivateFade=function(){this.options.fade&&(this.element.classList.remove("is-fade"),this.slides.forEach(function(e){e.setOpacity("")}))};var g=t.positionSlider;t.positionSlider=function(){if(!this.options.fade){g.apply(this,arguments);return}this.fadeSlides(),this.dispatchScrollEvent()};var v=t.positionSliderAtSelected;t.positionSliderAtSelected=function(){this.options.fade&&this.setTranslateX(0),v.apply(this,arguments)},t.fadeSlides=function(){if(!(this.slides.length<2)){var e=this.getFadeIndexes(),s=this.slides[e.a],i=this.slides[e.b],a=this.wrapDifference(s.target,i.target),d=this.wrapDifference(s.target,-this.x);d=d/a,s.setOpacity(1-d),i.setOpacity(d);var r=e.a;this.isDragging&&(r=d>.5?e.a:e.b);var l=this.fadeHideIndex!=null&&this.fadeHideIndex!=r&&this.fadeHideIndex!=e.a&&this.fadeHideIndex!=e.b;l&&this.slides[this.fadeHideIndex].setOpacity(0),this.fadeHideIndex=r}},t.getFadeIndexes=function(){return!this.isDragging&&!this.didDragEnd?{a:this.fadeIndex,b:this.selectedIndex}:this.options.wrapAround?this.getFadeDragWrapIndexes():this.getFadeDragLimitIndexes()},t.getFadeDragWrapIndexes=function(){var e=this.slides.map(function(o,S){return this.getSlideDistance(-this.x,S)},this),s=e.map(function(o){return Math.abs(o)}),i=Math.min.apply(Math,s),a=s.indexOf(i),d=e[a],r=this.slides.length,l=d>=0?1:-1;return{a,b:p.modulo(a+l,r)}},t.getFadeDragLimitIndexes=function(){for(var e=0,s=0;s<this.slides.length-1;s++){var i=this.slides[s];if(-this.x<i.target)break;e=s}return{a:e,b:e+1}},t.wrapDifference=function(e,s){var i=s-e;if(!this.options.wrapAround)return i;var a=i+this.slideableWidth,d=i-this.slideableWidth;return Math.abs(a)<Math.abs(i)&&(i=a),Math.abs(d)<Math.abs(i)&&(i=d),i};var x=t._getWrapShiftCells;t._getWrapShiftCells=function(){this.options.fade||x.apply(this,arguments)};var I=t.shiftWrapCells;return t.shiftWrapCells=function(){this.options.fade||I.apply(this,arguments)},n});
